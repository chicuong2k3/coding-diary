@page "/blog/sample2"


<PageTitle>asd</PageTitle>

<div class="content">
    <p>Trong cÃ¡c á»©ng dá»¥ng web vÃ  API ngÃ y nay, báº£o máº­t lÃ  má»™t pháº§n khÃ´ng thá»ƒ thiáº¿u. DÃ¹ báº¡n
xÃ¢y dá»±ng há»‡ thá»‘ng quáº£n lÃ½ ná»™i bá»™, thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ hay á»©ng dá»¥ng SaaS thÃ¬ viá»‡c Ä‘áº£m báº£o
ngÆ°á»i dÃ¹ng <strong>Ä‘Æ°á»£c xÃ¡c thá»±c chÃ­nh xÃ¡c</strong> vÃ  <strong>chá»‰ truy cáº­p Ä‘Æ°á»£c tÃ i nguyÃªn há» Ä‘Æ°á»£c phÃ©p</strong>
lÃ  háº¿t sá»©c quan trong. BÃ i viáº¿t nÃ y sáº½ giÃºp báº¡n náº¯m rÃµ:</p>
<ul>
<li><a href="/post/authentication-va-authorization-trong-net#authentication-va-authorization-la-gi">PhÃ¢n biá»‡t Authentication vÃ  Authorization</a></li>
<li><a href="/post/authentication-va-authorization-trong-net#kien-truc-authentication-trong.net">Hiá»ƒu kiáº¿n trÃºc Authentication trong .NET</a></li>
<li><a href="/post/authentication-va-authorization-trong-net#kien-truc-authorization-trong.net">Hiá»ƒu kiáº¿n trÃºc Authorization trong .NET</a></li>
<li><a href="/post/authentication-va-authorization-trong-net#cookie-authentication-thuong-dung-cho-web-app-nhu.net-mvc-va-razor-pages">Triá»ƒn khai Cookie Authentication</a></li>
<li><a href="/post/authentication-va-authorization-trong-net#jwt-bearer-authentication-thuong-dung-cho-api">Triá»ƒn khai JWT Bearer Authentication</a></li>
<li><a href="/post/authentication-va-authorization-trong-net#authorization-kiem-soat-quyen-truy-cap">KhÃ¡m phÃ¡ cÃ¡c cÆ¡ cháº¿ Authorization</a></li>
</ul>
<h1 id="authentication-va-authorization-la-gi">Authentication vÃ  Authorization lÃ  gÃ¬?</h1>
<p>ChÃºng ta cáº§n phÃ¢n biá»‡t rÃµ hai khÃ¡i niá»‡m quan trá»ng
mÃ  má»i láº­p trÃ¬nh viÃªn Ä‘á»u pháº£i náº¯m vá»¯ng lÃ  Authentication (xÃ¡c thá»±c) vÃ  Authorization (phÃ¢n quyá»n).
DÃ¹ nghe cÃ³ váº» quen thuá»™c nhÆ°ng ráº¥t nhiá»u ngÆ°á»i váº«n nháº§m láº«n giá»¯a chÃºng.</p>
<ul>
<li>Authentication (XÃ¡c thá»±c): LÃ  quÃ¡ trÃ¬nh xÃ¡c minh danh tÃ­nh cá»§a má»™t ngÆ°á»i, tá»©c lÃ  kiá»ƒm
tra xem báº¡n tháº­t sá»± lÃ  ai. VÃ­ dá»¥ nhÆ° khi báº¡n Ä‘áº¿n sÃ¢n bay, nhÃ¢n viÃªn an ninh yÃªu cáº§u báº¡n
xuáº¥t trÃ¬nh cÄƒn cÆ°á»›c cÃ´ng dÃ¢n hoáº·c há»™ chiáº¿u vÃ  vÃ© mÃ¡y bay. Há» kiá»ƒm tra áº£nh, tÃªn vÃ  mÃ£ vÃ© Ä‘á»ƒ
cháº¯c cháº¯n ráº±ng báº¡n chÃ­nh lÃ  ngÆ°á»i Ä‘Ã£ Ä‘áº·t vÃ©. ÄÃ³ chÃ­nh lÃ  xÃ¡c thá»±c.</li>
<li>Authorization (PhÃ¢n quyá»n): LÃ  quÃ¡ trÃ¬nh kiá»ƒm tra quyá»n háº¡n truy cáº­p hoáº·c hÃ nh Ä‘á»™ng
mÃ  báº¡n Ä‘Æ°á»£c phÃ©p thá»±c hiá»‡n sau khi Ä‘Ã£ xÃ¡c thá»±c danh tÃ­nh. VÃ­ dá»¥ nhÆ° sau khi báº¡n Ä‘Ã£ qua cá»­a
an ninh vÃ  lÃªn mÃ¡y bay, vÃ© háº¡ng phá»• thÃ´ng (Economy) chá»‰ cho phÃ©p báº¡n ngá»“i á»Ÿ khoang phá»• thÃ´ng,
trong khi vÃ© háº¡ng thÆ°Æ¡ng gia (Business Class) Ä‘Æ°á»£c phÃ©p ngá»“i á»Ÿ khoang riÃªng vÃ  sá»­ dá»¥ng phÃ²ng chá» VIP.
DÃ¹ cáº£ hai hÃ nh khÃ¡ch Ä‘á»u Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c thá»±c, quyá»n truy cáº­p cá»§a há» khÃ¡c nhau dá»±a trÃªn &quot;vai trÃ²&quot; (class).
ÄÃ¢y chÃ­nh lÃ  phÃ¢n quyá»n.</li>
</ul>
<MermaidContainer >
<p>flowchart LR
A[HÃ nh khÃ¡ch Ä‘áº¿n sÃ¢n bay] --&gt; B[XÃ¡c thá»±c danh tÃ­nh - kiá»ƒm tra CCCD hoáº·c há»™ chiáº¿u vÃ  vÃ©]
B --&gt; C{ÄÃ£ xÃ¡c thá»±c há»£p lá»‡?}
C -- KhÃ´ng --&gt; D[KhÃ´ng cho phÃ©p lÃªn mÃ¡y bay]
C -- CÃ³ --&gt; E[PhÃ¢n quyá»n theo loáº¡i vÃ©]
E --&gt; F[VÃ© Economy - Khoang phá»• thÃ´ng]
E --&gt; G[VÃ© Business - PhÃ²ng chá» VIP + khoang thÆ°Æ¡ng gia]</p>
</MermaidContainer>
<div class="alert alert-info" role="alert">
<div class="d-flex align-items-center">
<i class="bi-info-circle-fill flex-shrink-0 me-2"aria-label="Info:"></i>
<h5>Info:</h5>
</div>
<p><strong>Authentication</strong> tráº£ lá»i cho cÃ¢u há»i <strong>Báº¡n lÃ  ai</strong>
<strong>Authorization</strong> tráº£ lá»i cho cÃ¢u há»i <strong>Báº¡n Ä‘Æ°á»£c phÃ©p lÃ m gÃ¬</strong></p>
</div>
<h1 id="kien-truc-authentication-trong.net">Kiáº¿n trÃºc Authentication trong .NET</h1>
<p>Há»‡ thá»‘ng Authentication trong .NET Ä‘Æ°á»£c tá»• chá»©c dá»±a trÃªn 5 thÃ nh pháº§n chÃ­nh:</p>
<h2 id="authentication-middleware">Authentication Middleware</h2>
<p>Middleware nÃ y Ä‘Æ°á»£c thÃªm vÃ o pipeline báº±ng dÃ²ng sau:</p>
<pre><code class="language-csharp">app.UseAuthentication();

</code></pre>
<p>Middleware nÃ y lÃ  Ä‘iá»ƒm khá»Ÿi Ä‘áº§u cho quÃ¡ trÃ¬nh xÃ¡c thá»±c: khi cÃ³ request Ä‘áº¿n, Middleware sáº½ gá»i
phÆ°Æ¡ng thá»©c <code>AuthenticateAsync()</code> cá»§a interface <code>IAuthenticationService</code> (xem bÃªn dÆ°á»›i) Ä‘á»ƒ xÃ¡c Ä‘á»‹nh ngÆ°á»i dÃ¹ng hiá»‡n táº¡i.
Náº¿u thÃ nh cÃ´ng, <code>ClaimsPrincipal</code> sáº½ Ä‘Æ°á»£c gÃ¡n vÃ o <code>HttpContext.User</code>.</p>
<div class="alert alert-info" role="alert">
<div class="d-flex align-items-center">
<i class="bi-info-circle-fill flex-shrink-0 me-2"aria-label="Info:"></i>
<h5>Info:</h5>
</div>
<p>ğŸ’¡ Tip: <code>app.UseAuthentication()</code> chá»‰ thiáº¿t láº­p <code>HttpContext.User</code>, nÃ³ khÃ´ng cháº·n request.
Viá»‡c cháº·n request (vÃ­ dá»¥ yÃªu cáº§u Ä‘Äƒng nháº­p hoáº·c tráº£ vá» 401) do <code>UseAuthorization()</code> Ä‘áº£m nhiá»‡m á»Ÿ bÆ°á»›c sau.</p>
</div>
<h2 id="iauthenticationservice">IAuthenticationService</h2>
<p>ÄÃ¢y lÃ  bá»™ Ä‘iá»u phá»‘i trung tÃ¢m, nÃ³ quyáº¿t Ä‘á»‹nh handler (xem bÃªn dÆ°á»›i) nÃ o sáº½ thá»±c hiá»‡n viá»‡c xÃ¡c thá»±c dá»±a
trÃªn <code>AuthenticationScheme</code> (xem bÃªn dÆ°á»›i) Ä‘Æ°á»£c cáº¥u hÃ¬nh. Interface nÃ y cung cáº¥p cÃ¡c phÆ°Æ¡ng thá»©c sau:</p>
<ul>
<li><code>AuthenticateAsync</code>: XÃ¡c thá»±c yÃªu cáº§u hiá»‡n táº¡i vÃ  tráº£ vá» <code>AuthenticateResult</code>.</li>
<li><code>ChallengeAsync()</code>: Pháº£n há»“i khi yÃªu cáº§u cáº§n xÃ¡c thá»±c (redirect hoáº·c HTTP 401).</li>
<li><code>ForbidAsync()</code>: Pháº£n há»“i khi ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng nháº­p nhÆ°ng khÃ´ng Ä‘á»§ quyá»n (HTTP 403).</li>
<li><code>SignInAsync</code>: Táº¡o thÃ´ng tin Ä‘Äƒng nháº­p (cookie hoáº·c token).</li>
<li><code>SignOutAsync</code>: XÃ³a thÃ´ng tin Ä‘Äƒng nháº­p.</li>
</ul>
<div class="alert alert-info" role="alert">
<div class="d-flex align-items-center">
<i class="bi-info-circle-fill flex-shrink-0 me-2"aria-label="Info:"></i>
<h5>Info:</h5>
</div>
<p>ğŸ’¡ Tip: Interface nÃ y Ä‘Æ°á»£c .NET cung cáº¥p máº·c Ä‘á»‹nh thÃ´ng qua dependency injection.
Báº¡n cÃ³ thá»ƒ inject <code>IAuthenticationService</code> vÃ o Controller náº¿u muá»‘n thá»±c hiá»‡n xÃ¡c thá»±c
thá»§ cÃ´ng.<br />
ğŸ“˜ Tham kháº£o: <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.authentication.iauthenticationservice?view=aspnetcore-9.0">Microsoft Docs â€“ Authentication service</a></p>
</div>
<h2 id="authentication-scheme">Authentication Scheme</h2>
<p>Má»—i scheme lÃ  má»™t cáº¥u hÃ¬nh xÃ¡c thá»±c cá»¥ thá»ƒ, xÃ¡c Ä‘á»‹nh handler nÃ o sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng cho cÆ¡ cháº¿ Ä‘Ã³.
. Khi cáº¥u hÃ¬nh, báº¡n cÃ³ thá»ƒ Ä‘Äƒng kÃ½
nhiá»u Scheme, vÃ­ dá»¥ scheme dÃ¹ng JWT cho API, má»™t scheme khÃ¡c dÃ¹ng Cookie cho MVC web.</p>
<pre><code class="language-csharp">builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(JwtBearerDefaults.AuthenticationScheme, options =&gt; builder.Configuration.Bind(&quot;JwtSettings&quot;, options))
    .AddCookie(CookieAuthenticationDefaults.AuthenticationScheme, options =&gt; builder.Configuration.Bind(&quot;CookieSettings&quot;, options));
</code></pre>
<div class="alert alert-info" role="alert">
<div class="d-flex align-items-center">
<i class="bi-info-circle-fill flex-shrink-0 me-2"aria-label="Info:"></i>
<h5>Info:</h5>
</div>
<p>ğŸ’¡ Tip: Khi á»©ng dá»¥ng cÃ³ nhiá»u scheme (JWT cho API, Cookie cho Web), báº¡n cÃ³ thá»ƒ
dÃ¹ng <code>[Authorize(AuthenticationSchemes = &quot;JwtBearer&quot;)]</code> Ä‘á»ƒ buá»™c controller/action chá»‰
dÃ¹ng Ä‘Ãºng loáº¡i xÃ¡c thá»±c mong muá»‘n.</p>
</div>
<h2 id="authentication-handler">Authentication Handler</h2>
<p>Handler lÃ  thÃ nh pháº§n thá»±c thi cá»‘t lÃµi cá»§a quÃ¡ trÃ¬nh xÃ¡c thá»±c.
Má»—i scheme sáº½ tÆ°Æ¡ng á»©ng vá»›i má»™t handler cá»¥ thá»ƒ, vÃ­ dá»¥:</p>
<ul>
<li><code>CookieAuthenticationHandler</code>: Quáº£n lÃ½ xÃ¡c thá»±c dá»±a trÃªn cookie.</li>
<li><code>JwtBearerHandler</code>: Quáº£n lÃ½ xÃ¡c thá»±c dá»±a trÃªn JWT.</li>
<li><code>OpenIdConnectHandler</code>: Quáº£n lÃ½ xÃ¡c thá»±c theo chuáº©n OpenIDConnect hay WS-Federation.</li>
<li><code>RemoteAuthenticationHandler</code>: OAuth2/External Provider nhÆ° Google, Facebook...</li>
</ul>
<div class="alert alert-info" role="alert">
<div class="d-flex align-items-center">
<i class="bi-info-circle-fill flex-shrink-0 me-2"aria-label="Info:"></i>
<h5>Info:</h5>
</div>
<p>âš ï¸ Note: Náº¿u báº¡n khÃ´ng Ä‘áº·t <code>DefaultScheme</code>, há»‡ thá»‘ng sáº½ khÃ´ng biáº¿t dÃ¹ng handler nÃ o vÃ 
<code>AuthenticateAsync()</code> cÃ³ thá»ƒ tráº£ vá» null.</p>
</div>
<p>// ...existing content...</p>

</div>
